
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Emacs as a musical instrument - Joseph Wilk</title>
  <meta name="author" content="Joseph Wilk">


  <meta name="description" content="A simple goal, to directly connect Emacs to running hardware and software synthesisers with realtime control. Emacs as a musical instrument. I &hellip;">


  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <link rel="canonical" href="http://blog.josephwilk.net/art/emacs-as-a-musical-instrument.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Joseph Wilk" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<script src="http://disqus.com/forums/josephwilk/embed.js"></script>
<link href="http://fonts.googleapis.com/css?family=Bevan" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3020740-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <img src="/images/joe_small2.png" style="position:relative;border-radius: 8px;margin-right: 5px;border-style: solid;border-width: 1px;border-color: #DDD;" height="60" alt="Joseph Wilk">
  <span style="display:inline-block">
    <h1><a href="/">Joseph Wilk</a></h1>
    <h2>Things with code, creativity and computation.</h2>
  </span>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>

</ul>


<ul class="main-navigation">
 <li><a href="/">Home</a></li>
 <li><a href="/about">About</a></li>
 <li><a href="/speaking">Speaking</a></li>
 <li><a href="http://art.josephwilk.net">Art</a></li>
 <li><a href="/contact">Contact</a></li>
 <li><a href="/archives">Archives</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">

  <header>

      <h1 class="entry-title">Emacs as a Musical Instrument</h1>


      <p class="meta">












<time datetime="2018-05-16T14:00:00+01:00" pubdate data-updated="true">May 16<span>th</span>, 2018</time>

      </p>

  </header>


<div class="entry-content"><p>A simple goal, to directly connect Emacs to running hardware and software synthesisers with <strong>realtime</strong> control. Emacs as a musical instrument.</p>

<p>I already use code to control synths (as <a href="http://www.repl-electric.com/">Repl-Electric</a>) but there is a level of indirection between the code and the effect on the music. You push keys on your computer keyboard and nothing happens. Only when you run the code does the music change. I wanted to add realtime control to my performances while still remaining in code and Emacs. Bringing the performance closer to musical instruments were instant feedback is a core part of the performance experience.</p>

<p>I could use external hardware, like a MidiFighterTwister (<a href="https://www.midifighter.com/#Twister">https://www.midifighter.com/#Twister</a>) or TouchOSC (<a href="https://hexler.net/software/touchosc">https://hexler.net/software/touchosc</a>) but I’ve found the context switch of moving between coding to twiddling dials on hardware expensive. The code is my composition process, so it makes sense for the direct control to also be there.</p>

<h2>Playing the Emacs</h2>

<p>Sculpting sound live with Emacs.</p>

<div class="embed-container"><iframe src="https://player.vimeo.com/video/270101496?color=ff0179" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>


<h2>Scratching Samples with Emacs</h2>

<p>Doing crazy things with Emacs starts to open more doors in musical expression. Since we can control music hardware with Emacs, we can control the playhead position within a sample. Much like the needle of a record player.</p>

<p>Say we map the position of your cursor in the Emacs buffer to the position of the playback head. By moving around in your buffer you can scratch the sample.</p>

<div class="embed-container"><iframe src="https://player.vimeo.com/video/265189088?color=ff0179" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>


<h2>Emacs sending Musical Controls</h2>

<p>Sending messages to musical synths using midi and OSC.</p>

<h3>Emacs Communicating with Open Sound Control</h3>

<p>First we need a client within Emacs which will send OSC (<a href="https://en.wikipedia.org/wiki/Open_Sound_Control">https://en.wikipedia.org/wiki/Open_Sound_Control</a>) using UDP packets. There is thankfully already an Emacs package for this: osc: <a href="https://delysid.org/emacs/osc.html">https://delysid.org/emacs/osc.html</a></p>

<p>Creating a client and sending OSC messages:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span></span><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;osc</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="k">defvar</span> <span class="nv">osc-client</span> <span class="no">nil</span> <span class="s">&quot;Connection to send OSC From Emacs&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">osc-make-client</span> <span class="p">(</span><span class="nv">host</span> <span class="nv">port</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">make-network-process</span>
</span><span class='line'>   <span class="nb">:name</span> <span class="s">&quot;OSC client&quot;</span>
</span><span class='line'>   <span class="nb">:host</span> <span class="nv">host</span>
</span><span class='line'>   <span class="nb">:service</span> <span class="nv">port</span>
</span><span class='line'>   <span class="nb">:type</span> <span class="ss">&#39;datagram</span>
</span><span class='line'>   <span class="nb">:family</span> <span class="ss">&#39;ipv4</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">osc-connect</span> <span class="p">()</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="nv">osc-client</span>   <span class="p">(</span><span class="nf">delete-process</span> <span class="nv">osc-client</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="k">setq</span> <span class="nv">osc-client</span> <span class="p">(</span><span class="nv">osc-make-client</span> <span class="s">&quot;localhost&quot;</span> <span class="mi">4561</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nv">osc-connect</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nv">osc-send-message</span> <span class="nv">osc-client</span> <span class="nv">ADDRESS</span> <span class="nv">*ARGUMENTS</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Emacs Communicating with Midi</h3>

<p>A lot of musical hardware and software only supports midi. We are sending OSC 😕. Hence we need a quick way of converting our OSC message to a midi message. Why don’t you send midi from Emacs directly? It&rsquo;s not a new thought (<a href="https://www.emacswiki.org/emacs/EmacsMidi">https://www.emacswiki.org/emacs/EmacsMidi</a>), but I’ve seen no examples of getting it working. My answer here is path of least resistance, and I don’t feel like implementing the midi standard in Elisp.</p>

<p>Luis Lloret (<a href="https://github.com/llloret">https://github.com/llloret</a>) has create the lovely C++ lib <code>osmid</code> (<a href="https://github.com/llloret/osmid">https://github.com/llloret/osmid</a>) for converting between midi and OSC. And its FAST.</p>

<p>It compiles into two binary servers:</p>

<ul>
<li>m2o &ndash; midi to OSC</li>
<li>o2m &ndash; OSC to midi</li>
</ul>


<p>We launch the o2m server in a shell which will be listening on port <code>4561</code> and will forward on OSC messages as midi.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span></span><span class="nv">osmid/o2m</span> <span class="nv">-b</span> <span class="nv">-i</span> <span class="mi">4561</span> <span class="nv">-O</span> <span class="mi">4562</span> <span class="nv">-m</span> <span class="mi">6</span>
</span></code></pre></td></tr></table></div></figure>


<p>Midi has a fixed argument format while OSC is very flexible. Hence this a little jiggery pokery in get the source OSC message mapping to the midi arguments.</p>

<p>OSC message format:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span></span><span class="p">(</span><span class="nv">osc-send-message</span> <span class="nv">osc-client</span> <span class="nv">MIDI_HOST</span> <span class="nv">MIDI_CHANNEL</span> <span class="nv">MIDI_CONTROL_CODE</span> <span class="nv">MIDI_VALUE</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>For MIDI_HOST I’m using the <code>Inter-application communication</code> (IAC) driver on Mac. This registers <code>IAC Bus 1</code> as a midi device. I’m also sending a <code>control change</code> message, shaping the parameters rather than triggering notes. This could be any of the supported midi messages (<code>note_on</code>, <code>note_off</code>, <code>pitch_bend</code>, <code>poly_pressure</code>, etc).</p>

<p>Example of OSC to midi message:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span></span><span class="p">(</span><span class="nv">osc-send-message</span> <span class="nv">osc-client</span> <span class="s">&quot;/IAC Bus 1/control_change&quot;</span> <span class="mi">9</span> <span class="mi">100</span> <span class="mi">127</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The channel <code>9</code> and control code <code>100</code> seem magical. I’m routing those to synths via Ableton Live.</p>

<p><img src="/images/midi-routing.png"/></p>

<p>Any DAW would support this or you could send direct to a synth and not use <code>IAC</code>. Your MIDI_HOST would be the name your midi device registers as.</p>

<h2>Emacs GUI for Musical Controls</h2>

<p>We have the backend for sending live midi controls to hardware. Now we need some interface within Emacs to trigger it.</p>

<h3>Modelling Encoders in Emacs</h3>

<p>The design is based on the idea of dial encoders commonly found in music hardware.</p>

<p><img src="/images/pots.jpg"/></p>

<p>Our dials in code are float numbers. To turn our dials we borrow the idea from the Chrome inspector of scrolling through possible numeric values with the arrow keys.</p>

<p><img src="/images/chromeinspector.png"/></p>

<p>In our case every increment/decrement will send a live message to our synths.</p>

<p>We need to extract from the active Emacs buffer the thing we are trying to control. Finding the:</p>

<ul>
<li>Synth (the musical instrument)</li>
<li>Parameter (ie. amp, pan, lfo, filter)</li>
<li>Value 0-127 (whatever value we want to set param)</li>
</ul>


<p>Example changing the filter param:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span></span><span class="nv">zerocoast_cc</span> <span class="nv">lfo:</span> <span class="mf">0.49</span><span class="o">,</span> <span class="nv">filter:</span> <span class="nv">&lt;0.80&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;;; Synth =&gt; zerocoast</span>
</span><span class='line'><span class="c1">;;; Parameter =&gt; filter</span>
</span><span class='line'><span class="c1">;;; Value =&gt; 101.6 (127*0.80)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here comes a lot of Elisp and some hairy regexes.</p>

<h4>Emacs Code</h4>

<p>Thingatpt (<a href="https://www.emacswiki.org/emacs/ThingAtPoint">https://www.emacswiki.org/emacs/ThingAtPoint</a>) which is part of the standard lib is extremely useful here.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span></span><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;thingatpt</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;;The patterns for matching the beginning and</span>
</span><span class='line'><span class="c1">;;end of something that looks like a float</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">put</span> <span class="ss">&#39;float</span> <span class="ss">&#39;end-op</span>       <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;[0-9-]*\.[0-9-]*&quot;</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)))</span>
</span><span class='line'><span class="p">(</span><span class="nf">put</span> <span class="ss">&#39;float</span> <span class="ss">&#39;beginning-op</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">re-search-backward</span> <span class="s">&quot;[^0-9-\.]&quot;</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span> <span class="p">(</span><span class="nf">forward-char</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">change-number-at-point</span> <span class="p">(</span><span class="nv">fn-float-op</span><span class="p">)</span>
</span><span class='line'>  <span class="s">&quot;Check if the thing under the cursor looks like a</span>
</span><span class='line'><span class="s">  float and if so change it with `fn-float-op`.</span>
</span><span class='line'><span class="s">  `fn-float-op` is passed the name of the synth,</span>
</span><span class='line'><span class="s">  parameter and float value.&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">bounds</span> <span class="p">(</span><span class="nv">bounds-of-thing-at-point</span> <span class="ss">&#39;float</span><span class="p">))</span>
</span><span class='line'>         <span class="p">(</span><span class="nv">float-val</span> <span class="p">(</span><span class="nf">buffer-substring</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">bounds</span><span class="p">)</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">bounds</span><span class="p">)))</span>
</span><span class='line'>         <span class="p">(</span><span class="nv">cursor-point</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">bounds</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">re-search-backward</span> <span class="s">&quot;^\\([^\n]+\\): &quot;</span> <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">synth-str</span> <span class="p">(</span><span class="nv">match-string</span> <span class="mi">1</span> <span class="no">nil</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">bounds</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">delete-char</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">float-val</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">parts</span> <span class="p">(</span><span class="nv">split-string</span> <span class="p">(</span><span class="nv">string-trim</span> <span class="nv">synth-str</span><span class="p">)</span> <span class="s">&quot; &quot;</span><span class="p">))</span>
</span><span class='line'>             <span class="p">(</span><span class="nv">synth-and-param</span> <span class="p">(</span><span class="k">if</span> <span class="nv">m</span>
</span><span class='line'>                                  <span class="p">(</span><span class="nf">concat</span>
</span><span class='line'>                                    <span class="p">(</span><span class="nv">replace-regexp-in-string</span>
</span><span class='line'>                                     <span class="s">&quot;^#&quot;</span> <span class="s">&quot;&quot;</span> <span class="p">(</span><span class="nv">first</span> <span class="nv">parts</span><span class="p">))</span>
</span><span class='line'>                                     <span class="s">&quot;/&quot;</span>
</span><span class='line'>                                     <span class="p">(</span><span class="nv">first</span> <span class="p">(</span><span class="nf">reverse</span> <span class="nv">parts</span><span class="p">)))</span>
</span><span class='line'>                                 <span class="no">nil</span><span class="p">)))</span>
</span><span class='line'>        <span class="p">(</span><span class="nf">insert</span>
</span><span class='line'>         <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%.2f&quot;</span>
</span><span class='line'>                 <span class="p">(</span><span class="nf">funcall</span> <span class="nv">fn-float-op</span>
</span><span class='line'>                   <span class="p">(</span><span class="nf">string-to-number</span> <span class="nv">float-val</span><span class="p">)</span>
</span><span class='line'>                   <span class="nv">synth-and-param</span><span class="p">)))))</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">cursor-point</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">inc-float-at-point</span> <span class="p">()</span>
</span><span class='line'>  <span class="s">&quot;Increase a float value and send OSC message.&quot;</span>
</span><span class='line'>  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">change-number-at-point</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">float-val</span> <span class="nv">synth-and-param</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">new-float</span> <span class="p">(</span><span class="nf">min</span> <span class="mf">1.00</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">float-val</span> <span class="mf">0.01</span><span class="p">))))</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">route-osc-message</span> <span class="nv">synth-and-param</span> <span class="nv">new-float</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">new-float</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">dec-float-at-point</span> <span class="p">()</span>
</span><span class='line'>  <span class="s">&quot;Decrease a float value and send OSC message.&quot;</span>
</span><span class='line'>  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">change-number-at-point</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">float-val</span> <span class="nv">synth-and-param</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">new-float</span> <span class="p">(</span><span class="nf">max</span> <span class="mf">0.00</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">float-val</span> <span class="mf">0.01</span><span class="p">))))</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">route-osc-message</span> <span class="nv">synth-and-param</span> <span class="nv">new-float</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">new-float</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We map our <code>synth-and-param</code> to the correct midi port and channel.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">route</span><span class="err">—</span><span class="nv">osc-msg</span> <span class="p">(</span><span class="nv">synth-and-param</span> <span class="nv">float-val</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">when</span> <span class="nv">synth-and-param</span>
</span><span class='line'>    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">midi-val</span> <span class="p">(</span><span class="nf">round</span> <span class="p">(</span><span class="nf">*</span> <span class="mf">127.0</span> <span class="nv">float-val</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="nv">host</span> <span class="s">&quot;/IAC Bus 1/control_change&quot;</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">osc-client</span><span class="p">)</span> <span class="p">(</span><span class="nv">osc-connect</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="k">cond</span>
</span><span class='line'>       <span class="p">((</span><span class="nf">string-match</span> <span class="nv">synth-and-param</span> <span class="s">&quot;zerocoast/filter&quot;</span><span class="p">)</span>
</span><span class='line'>         <span class="p">(</span><span class="nv">osc-send-message</span> <span class="nv">osc-client</span> <span class="nv">host</span> <span class="mi">9</span> <span class="mi">100</span> <span class="nv">midi-val</span><span class="p">)))))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally the keybindings that trigger our instrument mode:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">[(</span><span class="nv">meta</span> <span class="nv">up</span><span class="p">)]</span>    <span class="ss">&#39;inc-float-at-point</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">[(</span><span class="nv">meta</span> <span class="nv">down</span><span class="p">)]</span>  <span class="ss">&#39;dec-float-at-point</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Encoder ASCII Art</h3>

<p>We are almost done. For fun I’ve added a visually aid to the position of the float encoder. Midi messages are generally limited to 0-127 values, so if we map that to 0-100% we can create a visual representation of the current setting.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">code-&gt;pots</span> <span class="p">(</span><span class="nv">beg</span> <span class="nv">end</span><span class="p">)</span>
</span><span class='line'>  <span class="s">&quot;Add a ASCII encoder bar to anything that looks like a tweakable float&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">(</span><span class="k">interactive</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">save-excursion</span>
</span><span class='line'>    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">inhibit-read-only</span> <span class="no">t</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">remove-text-properties</span> <span class="nv">beg</span> <span class="nv">end</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">read-only</span> <span class="no">t</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">end</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="k">setq</span> <span class="nv">i</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="nf">re-search-backward</span> <span class="s">&quot;_cc .+:\s*\\([0-9]*.[0-9]+\\)\s*\n&quot;</span> <span class="nv">beg</span> <span class="no">t</span><span class="p">)</span>
</span><span class='line'>        <span class="p">(</span><span class="k">setq</span> <span class="nv">i</span> <span class="p">(</span><span class="nf">+</span> <span class="mi">1</span> <span class="nv">i</span><span class="p">))</span>
</span><span class='line'>        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">full</span>     <span class="p">(</span><span class="nf">round</span> <span class="p">(</span><span class="nf">*</span> <span class="nv">MAX-LENGTH</span> <span class="p">(</span><span class="nf">string-to-number</span> <span class="p">(</span><span class="nv">match-string</span> <span class="mi">1</span><span class="p">))))))</span>
</span><span class='line'>          <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">empty</span>  <span class="p">(</span><span class="nf">-</span> <span class="nv">MAX-LENGTH</span> <span class="nv">full</span><span class="p">)))</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">))</span>
</span><span class='line'>            <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span>
</span><span class='line'>            <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">start-pnt</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
</span><span class='line'>                  <span class="p">(</span><span class="nv">pad</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">&gt;=</span> <span class="nv">empty</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>                           <span class="p">(</span><span class="nf">make-string</span> <span class="nv">empty</span> <span class="sc">?╌</span><span class="p">)</span>
</span><span class='line'>                         <span class="s">&quot;&quot;</span><span class="p">)))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot; #╟&quot;</span>
</span><span class='line'>                              <span class="p">(</span><span class="nf">make-string</span> <span class="nv">full</span> <span class="sc">?▓</span><span class="p">)</span>
</span><span class='line'>                              <span class="s">&quot;▒░&quot;</span>
</span><span class='line'>                              <span class="nv">pad</span>
</span><span class='line'>                              <span class="s">&quot;╢&quot;</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">put-text-property</span> <span class="nv">start-pnt</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="ss">&#39;read-only</span> <span class="no">t</span><span class="p">)))))</span>
</span><span class='line'>      <span class="p">(</span><span class="nv">align-regexp</span> <span class="nv">beg</span> <span class="p">(</span><span class="nf">+</span> <span class="p">(</span><span class="nf">*</span> <span class="nv">i</span> <span class="mi">106</span><span class="p">)</span> <span class="nv">end</span><span class="p">)</span> <span class="s">&quot;\\(\\s-*\\)#&quot;</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">pots-update</span> <span class="p">(</span><span class="nv">new-float</span> <span class="nv">old-float</span><span class="p">)</span>
</span><span class='line'>  <span class="s">&quot;Update ASCII encoder bar for float being changed&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">new-float</span> <span class="nv">old-float</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">old-full</span> <span class="p">(</span><span class="nf">round</span> <span class="p">(</span><span class="nf">*</span> <span class="mf">100.0</span> <span class="nv">old-float</span><span class="p">)))</span>
</span><span class='line'>            <span class="p">(</span><span class="nv">full</span>     <span class="p">(</span><span class="nf">round</span> <span class="p">(</span><span class="nf">*</span> <span class="mf">100.0</span> <span class="nv">new-float</span><span class="p">))))</span>
</span><span class='line'>        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">empty</span>  <span class="p">(</span><span class="nf">-</span> <span class="nv">MAX-LENGTH</span> <span class="nv">full</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">movement</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">full</span> <span class="nv">old-full</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nv">bmovement</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">old-full</span> <span class="nv">full</span><span class="p">)))</span>
</span><span class='line'>          <span class="p">(</span><span class="k">save-excursion</span>
</span><span class='line'>            <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&quot;#╟&quot;</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">match-end</span> <span class="mi">0</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">inhibit-read-only</span> <span class="no">t</span><span class="p">)</span>
</span><span class='line'>                    <span class="p">(</span><span class="nv">start-pnt</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
</span><span class='line'>                <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="nv">new-number</span> <span class="nv">old-float</span><span class="p">)</span>
</span><span class='line'>                    <span class="p">(</span><span class="k">progn</span> <span class="c1">;;forwards</span>
</span><span class='line'>                      <span class="p">(</span><span class="nf">forward-char</span> <span class="nv">old-full</span><span class="p">)</span>
</span><span class='line'>                      <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">make-string</span> <span class="nv">movement</span> <span class="sc">?▓</span><span class="p">))</span>
</span><span class='line'>                      <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>                      <span class="p">(</span><span class="nf">delete-char</span> <span class="nv">movement</span><span class="p">))</span>
</span><span class='line'>                  <span class="p">(</span><span class="k">progn</span> <span class="c1">;;backwards</span>
</span><span class='line'>                    <span class="p">(</span><span class="nf">forward-char</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">old-full</span> <span class="nv">bmovement</span><span class="p">))</span>
</span><span class='line'>                    <span class="p">(</span><span class="nf">delete-char</span> <span class="nv">bmovement</span><span class="p">)</span>
</span><span class='line'>                    <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>                    <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">make-string</span> <span class="nv">bmovement</span> <span class="sc">?╌</span><span class="p">))))</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">put-text-property</span> <span class="nv">start-pnt</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="ss">&#39;read-only</span> <span class="no">t</span><span class="p">))))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Ascii dials:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span></span><span class="nv">zerocoast_cc</span> <span class="nv">amp:</span> <span class="mf">0.18</span> <span class="err">#╟▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒░╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╢</span>
</span><span class='line'>
</span><span class='line'><span class="nv">zerocoast_cc</span> <span class="nv">amp:</span> <span class="mf">1.00</span> <span class="err">#╟▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒░╢</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Binding into a Performance</h2>

<p>All this work was used in my recent performance:</p>

<p>“You Fall into Your Screen”: <a href="https://vimeo.com/replelectric/you-fall-into-your-screen">https://vimeo.com/replelectric/you-fall-into-your-screen</a></p>

<p>I’m using Emacs to simultaneous control Synths and Unity3D in much the same way discussed in this post. It feels pretty amazing to augment the performance with this live control.</p>
</div>


  <footer>
    <p class="meta">



<span class="byline author vcard">Posted by <span class="fn">Joseph Wilk</span></span>













<time datetime="2018-05-16T14:00:00+01:00" pubdate data-updated="true">May 16<span>th</span>, 2018</time>


<span class="categories">

    <a class='category' href='/art'>art</a>

</span>


    </p>

      <div class="sharing">

  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://blog.josephwilk.net/art/emacs-as-a-musical-instrument.html" data-via="josephwilk" data-counturl="http://blog.josephwilk.net/art/emacs-as-a-musical-instrument.html" >Tweet</a>


  <div class="g-plusone" data-size="small"></div>


</div>


    <p class="meta">

        <a class="basic-alignment left" href="/clojure/functions-explained-through-patterns.html" title="Previous Post: Functions Explained Through Patterns">&laquo; Functions Explained Through Patterns</a>


    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">

    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
  <li class="post">
    <a href="/art/emacs-as-a-musical-instrument.html">Emacs as a musical instrument</a>
  </li>


      <li class="post">
        <a href="/art/emacs-as-a-musical-instrument.html">Emacs as a musical instrument</a>
      </li>

      <li class="post">
        <a href="/clojure/functions-explained-through-patterns.html">Functions Explained Through Patterns</a>
      </li>

      <li class="post">
        <a href="/art/audio-fingerprint-smudges.html">Audio Fingerprint Smudges</a>
      </li>

      <li class="post">
        <a href="/art/overtone-shader-visuals.html">Visuals with Overtone and Shadertone</a>
      </li>

      <li class="post">
        <a href="/art/emacs-animation.html">Animations with Emacs</a>
      </li>

      <li class="post">
        <a href="/clojure/clojure-and-kinesis-at-scale.html">Clojure and Kinesis at scale</a>
      </li>

      <li class="post">
        <a href="/clojure/overtone-driving-minecraft.html">Clojure and Overtone driving Minecraft</a>
      </li>

      <li class="post">
        <a href="/art/live-coding-repl-electric.html">Live Coding - Repl Electric</a>
      </li>

      <li class="post">
        <a href="/clojure/creative_machines.html">Creative Machines</a>
      </li>

      <li class="post">
        <a href="/clojure/sounds-of-the-human-brain.html">Sounds of the human brain</a>
      </li>

  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>

  <a href="https://github.com/josephwilk">@josephwilk</a> on GitHub

  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'josephwilk',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>






</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Joseph Wilk -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>


<script type="text/javascript">
      var disqus_shortname = 'josephwilk';


        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.josephwilk.net/art/emacs-as-a-musical-instrument.html';
        var disqus_url = 'http://blog.josephwilk.net/art/emacs-as-a-musical-instrument.html';
        var disqus_script = 'embed.js';

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
