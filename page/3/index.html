
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Joseph Wilk</title>
  <meta name="author" content="Joseph Wilk">

  
  <meta name="description" content="Currently in the Science team at Songkick I&rsquo;ve been working with Apache Pig to generate lots of interesting metrics for our business &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.josephwilk.net/page/3/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Joseph Wilk" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<script src="http://disqus.com/forums/josephwilk/embed.js"></script>
<link href="http://fonts.googleapis.com/css?family=Bevan" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3020740-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <img src="/images/joe_small2.png" style="position:relative;border-radius: 8px;margin-right: 5px;border-style: solid;border-width: 1px;border-color: #DDD;" height="60" alt="Joseph Wilk">
  <span style="display:inline-block">
    <h1><a href="/">Joseph Wilk</a></h1>
    <h2>Things with code, creativity and computation.</h2>
  </span>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
  
<ul class="main-navigation">
 <li><a href="/">Home</a></li>
 <li><a href="/about">About</a></li>
 <li><a href="/speaking">Speaking</a></li>
 <li><a href="http://art.josephwilk.net">Art</a></li>
 <li><a href="/contact">Contact</a></li>
 <li><a href="/archives">Archives</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/big-data/a-little-bit-of-pig.html">A Little Bit of Pig</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-11T17:35:41+01:00" pubdate data-updated="true">Jun 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Currently in the Science team at Songkick I&rsquo;ve been working with Apache Pig to generate lots of interesting metrics for our business intelligence. We use Amazon&rsquo;s MapReduce and Pig to avoid having to run complex, long running and intensive queries on our live db, we can run them on Amazon in a timely fashion instead. So lets dive into Pig and how we use it at Songkick.com.</p>

<h2>Pig (whats with all these silly names)</h2>

<p>The Apache project Pig is a data flow language designed for analysing large datasets. It provides a high-level platform for creating MapReduce programs used with <em>Hadoop. </em>A little bit like SQL but Pig&rsquo;s programs by their structure are suitable for <strong>parallelization</strong>, which is why they are great at  handling very large data sets.</p>

<p><img src="/images/blog/2012/05/pig-300x284.gif" alt="" /></p>

<p>Heres how we use Pig and ElasticMapReduce at Songkick in our Science team.</p>

<h2>Data (Pig food)</h2>

<p><img src="/images/blog/2012/06/pig_eating.png" alt="" /></p>

<p>Lets start by uploading some huge and interesting data about Songkicks artists onto S3. We start by dumping a table from mysql (along with a lot of other tables) and then query that data with Pig on Hadoop. While we could extract all the artist data by querying the live table its actually faster to use mysqldump and dump the table as a TSV file.</p>

<p>For example it took 35 minutes to dump our artist table with a sql query &lsquo;select * from artists&rsquo;. It takes 10 minutes to dump the entire table with mysqldump.</p>

<p>We format the table dump as a TSV which we push to S3 as that makes it super easy to use Amazons ElasticMapReduce with Pig.</p>

<pre><code>shell&gt; mysqldump --user=joe --password  --fields-optionally-enclosed-by='"'
                  --fields-terminated-by='\t' --tab /tmp/path_to_dump/ songkick artist_trackings
</code></pre>

<p>Unfortunately this has to be run on the db machine since mysqldump needs access to the file system to save the data. If this is a problem for you there is a Ruby script for dumping tables to TSV: <a href="http://github.com/apeckham/mysqltsvdump/blob/master/mysqltsvdump.rb">http://github.com/apeckham/mysqltsvdump/blob/master/mysqltsvdump.rb</a></p>

<h2>Launching (Pig catapult)</h2>

<p><img src="/images/blog/2012/06/flying_pig.png" alt="" /></p>

<p>We will be using Amazons Elastic MapReduce to run our Pig scripts. We can start our job in interactive Pig mode which allows us to ssh to the box and run the pig script line by line.</p>

<p><img src="/images/blog/2012/05/aws_pig.png" alt="" /></p>

<h2>Examples (Dancing Pigs)</h2>

<p><img src="/images/blog/2012/06/dancing_pigs1.jpg" alt="" /></p>

<p>An important thing to note when running pig scripts interactively is that they defer execution until they have to expose a result. This means you can get nice schema checks and validations helping ensure your PIG script is valid without actually executing it over your large dataset.</p>

<p>We are going to try and calculate the average number of users tracking an artist based on the condition that we only count users who logged in, in the last 30 days.</p>

<p>This is what our Pig script is doing:</p>

<p><img src="/images/blog/2012/06/query6.png" alt="" /></p>

<p>The Pig script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-- Define some useful dates we will use later
</span><span class='line'>%default TODAYS_DATE `date  +%Y/%m/%d`
</span><span class='line'>%default 30_DAYS_AGO `date -d "$TODAYS_DATE - 30 day" +%Y-%m-%d`
</span><span class='line'>    
</span><span class='line'>-- Pig is smart enough when given a folder to go and find files, decompress them if necessarily and load them.
</span><span class='line'>-- Note we have to specify the schema as PIG does not know know this from our TSV file.
</span><span class='line'>trackings = LOAD 's3://songkick/db/trackings/$TODAYS_DATE/' AS (id:int, artist_id:int,  user_id:int); 
</span><span class='line'>users = LOAD 's3://songkick/db/users/$TODAYS_DATE/' AS (id:int, username:chararray, last_logged_in_at:chararray);</span></code></pre></td></tr></table></div></figure>


<pre><code>trackings
&lt;1, 1, 1&gt;
&lt;2, 1, 2&gt;

users
&lt;1,'josephwilk', '11/06/2012'&gt;
&lt;2,'elisehuard', '11/06/2012'&gt;
&lt;3,'tycho', '11/06/2010'&gt;
</code></pre>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-- Filter users to only those who logged in, in the last 30 days
</span><span class='line'>    -- Pig does not understand dates, so just treat them as strings
</span><span class='line'>    active_users = FILTER users by last_logged_in_at gte '$30_DAYS_AGO'</span></code></pre></td></tr></table></div></figure>


<pre><code>Users
&lt;1,'josephwilk', '11/06/2012'&gt;
&lt;2,'elisehuard', '11/06/2012'&gt;
</code></pre>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>active_users_and_trackings = JOIN active_users BY id, trackings BY user_id
</span><span class='line'>    
</span><span class='line'>    -- group all the users tracking an artists so we can count them.
</span><span class='line'>    active_users_and_trackings_grouped = GROUP active_users_and_trackings BY active_users::user_id;</span></code></pre></td></tr></table></div></figure>


<pre><code>&lt;1, 1, /\{&lt;1,'josephwilk', '11/06/2012'&gt;, &lt;2,'elisehuard', '11/06/2012'&gt;\/}&gt;`
</code></pre>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>trackings_per_artist = FOREACH active_users_and_trackings_grouped GENERATE group, COUNT($2) as number_of_trackings;</span></code></pre></td></tr></table></div></figure>


<pre><code>`&lt;\/{&lt;1,'josephwilk', '11/06/2012'&gt;, &lt;2,'elisehuard', '11/06/2012'&gt;\/}, 2&gt;`
</code></pre>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-- group all the counts so we can calculate the average
</span><span class='line'>    all_trackings_per_artist = GROUP trackings_per_artist ALL;</span></code></pre></td></tr></table></div></figure>


<pre><code>&lt;\/{\/{&lt;1,'josephwilk', '11/06/2012'&gt;, &lt;2,'elisehuard', '11/06/2012'&gt;\/}, 2\/}&gt;
</code></pre>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-- Calculate the average
</span><span class='line'>    average_artist_trackings_per_active_user = FOREACH all_trackings_per_artist
</span><span class='line'>      GENERATE '$DATE' as dt, AVG(trackings_per_artist.number_of_trackings);</span></code></pre></td></tr></table></div></figure>


<pre><code>&lt;{&lt;'11/062012', 2&gt;}&gt;
</code></pre>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>--Now we have done the work store the result in S3.
</span><span class='line'>    STORE average_artist_trackings_per_active_user INTO
</span><span class='line'>      's3://songkick/stats/average_artist_trackings_per_active_user/$TODAYS_DATE'</span></code></pre></td></tr></table></div></figure>


<h2>Debugging Pigs (Pig autopsy)</h2>

<p><img src="/images/blog/2012/06/pig_insides.png" alt="" />
In an interactive pig session there are two useful commands for debugging:
<strong>DESCRIBE</strong> to see the schema.
<strong>ILLUSTRATE</strong> to see the schema with sample data:</p>

<pre><code>DESCRIBE users;
users: {id:int, username:chararray, created_at:chararray, trackings:int}

ILLUSTRATE users;
----------------------------------------------------------------------
| users   | id: int | username:chararray | created_at | trackings:int |
----------------------------------------------------------------------
|         | 18      | Joe                | 10/10/13   | 1000          |
|         | 20      | Elise              | 10/10/14   | 2300          |
----------------------------------------------------------------------
</code></pre>

<h2>Automating Elastic MapReduce (Pig robots)</h2>

<p><img src="/images/blog/2012/06/pig_robot.png" alt="" /></p>

<p>Once you are happy with your script you&rsquo;ll want to automate all of this. I currently do this by having a cron task which at regular intervals uses the  elastic-mapreduce-ruby lib to fire up a elastic map reduce job and run it with the pig script to execute.</p>

<p>Its important to note that I <em>store the pig scripts on S3</em> so its easy for elastic-mapreduce to find the scripts.</p>

<p>Follow the instructions to install elastic-mapreduce-ruby: <a href="https://github.com/tc/elastic-mapreduce-ruby">https://github.com/tc/elastic-mapreduce-ruby</a></p>

<p>To avoid having to call elastic-mapreduce with 100s of arguments a colleague has written a little python wrapper to make it quick and easy to use: <a href="https://gist.github.com/2911006">https://gist.github.com/2911006</a></p>

<p>You&rsquo;ll need to configure where you&rsquo;re elastic-mapreduce tool is installed AND where you want elastic map-reduce to log to on S3 (this means you can debug your elastic map reduce job if things go wrong!).</p>

<p>Now all we need to do is pass the script the path to the pig script on S3.</p>

<pre><code>./emrjob s3://songkick/lib/stats/pig/average_artist_trackings_per_active_user.pig
</code></pre>

<h2>Testing with PigUnit (Simulating Pigs)</h2>

<p><img src="/images/blog/2012/06/virtual_pig.png" alt="" /></p>

<p>Pig scripts can still take a long time to run even with all that Hadoop magic. Thankfully there is a testing framework PigUnit.</p>

<p><a href="http://pig.apache.org/docs/r0.8.1/pigunit.html#Overview">http://pig.apache.org/docs/r0.8.1/pigunit.html#Overview</a></p>

<p>Unfortunately this is where you have to step into writing Java. So I skipped it. Sshhh.</p>

<h2>References</h2>

<ol>
<li><p> Apache Pig official site: <a href="http://pig.apache.org/">http://pig.apache.org</a></p></li>
<li><p> Nearest Neighbours with Apache Pig and JRuby: <a href="http://thedatachef.blogspot.co.uk/2011/10/nearest-neighbors-with-apache-pig-and.html">http://thedatachef.blogspot.co.uk/2011/10/nearest-neighbors-with-apache-pig-and.html </a></p></li>
<li><p> Helpers for messing with Elastic MapReduce in Ruby <a href="https://github.com/tc/elastic-mapreduce-ruby">https://github.com/tc/elastic-mapreduce-ruby</a></p></li>
<li><p> mysqltsvdump <a href="http://github.com/apeckham/mysqltsvdump/blob/master/mysqltsvdump.rb">http://github.com/apeckham/mysqltsvdump/blob/master/mysqltsvdump.rb</a></p></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/cucumber/examples-are-not-a-specification.html">Examples Alone Are Not a Specification</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-24T14:25:30+00:00" pubdate data-updated="true">Feb 24<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The Gherkin syntax used by Cucumber enforces that Feature files contain scenarios which are examples of the behaviour of a feature. However Gherkin has no constraints on if there is a specification present. Examples are great at helping us understand specifications but <strong>they are not specifications themselves</strong>.</p>

<p>What do we mean when we say specification?</p>

<p><em>definition: A detailed, exact statement of particulars</em></p>

<p>In a Gherkin feature the specification lives here:</p>

<p><img src="/images/blog/2012/02/spec7.png" alt="" /></p>

<p>Lets look at a real example:</p>

<h2>A Feature with just Examples</h2>

<p>A Cucumber example based on a feature  (which I have modified) from the test library Rspec <a href="https://github.com/rspec/rspec-expectations">rspec-expectations</a>:</p>

<pre><code>Feature: be_within matcher
  Scenario: basic usage
  Given a file named "be_within_matcher_spec.rb" with:
  """
  describe 27.5 do
  it { should be_within(0.5).of(27.9) }
  it { should be_within(0.5).of(27.1) }
  it { should_not be_within(0.5).of(28) }
  it { should_not be_within(0.5).of(27) }
  # deliberate failures
  it { should_not be_within(0.5).of(27.9) }
  it { should_not be_within(0.5).of(27.1) }
  it { should be_within(0.5).of(28) }
  it { should be_within(0.5).of(27) }
  end
  """
  When I run `rspec be_within_matcher_spec.rb`
  Then the output should contain all of these:
  | 8 examples, 4 failures                     |
  | expected 27.5 not to be within 0.5 of 27.9 |
  | expected 27.5 not to be within 0.5 of 27.1 |
  | expected 27.5 to be within 0.5 of 28       |
  | expected 27.5 to be within 0.5 of 27       |
</code></pre>

<p>So where is the explanation of what <em>be_within</em> does? If I want to know how <em>be_within</em> works I want a single concise explanation not 5/6 different examples. Examples add value later to validate that specification.</p>

<h2>A Feature with both Specification and Examples</h2>

<p>Lets add back in the specification part of the Feature. <em>drum roll</em></p>

<pre><code>Feature: be_within matcher

  Normal equality expectations do not work well for floating point values.
  Consider this irb session:

      &gt; radius = 3
        =&gt; 3 
      &gt; area_of_circle = radius * radius * Math::PI
        =&gt; 28.2743338823081 
      &gt; area_of_circle == 28.2743338823081
        =&gt; false 

  Instead, you should use the be_within matcher to check that the value
  is within a delta of your expected value:

      area_of_circle.should be_within(0.1).of(28.3)

  Note that the difference between the actual and expected values must be
  smaller than your delta; if it is equal, the matcher will fail.

  Scenario: basic usage
    Given a file named "be_within_matcher_spec.rb" with:
      """
      describe 27.5 do
        it { should be_within(0.5).of(27.9) }
        it { should be_within(0.5).of(27.1) }
        it { should_not be_within(0.5).of(28) }
        it { should_not be_within(0.5).of(27) }

        # deliberate failures
        it { should_not be_within(0.5).of(27.9) }
        it { should_not be_within(0.5).of(27.1) }
        it { should be_within(0.5).of(28) }
        it { should be_within(0.5).of(27) }
      end
      """
    When I run `rspec be_within_matcher_spec.rb`
    Then the output should contain all of these:
      | 8 examples, 4 failures                     |
      | expected 27.5 not to be within 0.5 of 27.9 |
      | expected 27.5 not to be within 0.5 of 27.1 |
      | expected 27.5 to be within 0.5 of 28       |
      | expected 27.5 to be within 0.5 of 27       |
</code></pre>

<p>Thats better, we can get an explanation of why this method exists and how to use it.</p>

<h2>Imagine RSpec without the specification</h2>

<p>I think of a Cucumber feature without a specification much like an Rspec example without any English sentence/description.</p>

<pre><code>context "" do
  it "" do
    user = Factory(:user)
    user.generate_password
    user.activate

    get "/session/new", :user_id =&gt; user.id

    last_response.should == "Welcome #{user.name}"
  end
end
</code></pre>

<p>Feels a little odd doesn&rsquo;t it.</p>

<h2>Cucumber Features as Documentation (for real)</h2>

<p>Rspec is an example of a project that has taken its Cucumber features and <a href="https://www.relishapp.com/rspec">published them as its documentation</a>. Just browse through those features and it quickly highlights how important it is to have a specification as well as examples. Imagine an API with nothing but examples, leaving you the detective work of trying to work out what the thing actually does.</p>

<p>Documentation needs to explain/specify what something does as well provide examples. If you really want anyone to read your feature provide both examples and a specification.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/testing/co-chair-of-the-agile-alliance-functional-testing-tools-group.html">Co-chair of the Agile Alliance Functional Testing Tools Group</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-13T18:40:27+00:00" pubdate data-updated="true">Feb 13<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;m happy to announce that I have joined <a href="http://testobsessed.com">Elizabeth Hendrickson</a> as Co-Chair of the Agile Alliance Functional Testing Tools group (AAFTT, yes the name is a bit of a mouthful).</p>

<p>I came across the AAFTT group when they organised a pattern writing workshop in London 2010, facilitated by <a href="http://www.lindarising.org/">Linda Rising</a>. It was an opportunity to bringing together some of the thought leaders in testing and share experiences. Somehow I managed to sneak in and proceded to steal all these experts knowledge. The AAFTT also runs an open space pria to the Agile conference. Last year I was surprised to find people who had travelled to the conference just for the AAFTT open space!</p>

<p>As a developer who loves messing around with testing tools, I’ll happily admit I know little about testing as a profession. The scope and breath of ideas that the AAFTT exposed me to has left me excited and hungry to play with new tools, ideas and patterns to make testing as fun as it should be. I hope as a developer who is obsessed about testing I can help blur the lines between developers and testers. I’m both.</p>

<p>Want to know more about the Agile Alliance Functional Testing Tools group?</p>

<ul>
<li><p>Mailing list: <a href="http://tech.groups.yahoo.com/group/aa-ftt/">http://tech.groups.yahoo.com/group/aa-ftt/</a></p></li>
<li><p>AAFTT workshop 2009, Chicago <a href="http://cds43.wordpress.com/2009/10/06/aaftt-workshop-2009-chicago/">http://cds43.wordpress.com/2009/10/06/aaftt-workshop-2009-chicago/</a></p></li>
<li><p>Records from previous AAFTT workshops: <a href="http://www.managing-expectations.com">http://www.managing-expectations.com</a></p></li>
</ul>


<p>And keep your ears open for any events!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/cucumber/mining-cucumber-features.html">Mining Cucumber Features</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-26T18:00:23+01:00" pubdate data-updated="true">Jul 26<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Failure Rates vs Change Rates</h2>

<p>I&rsquo;ve been spending a lot of  time recently data mining our test suite at Songkick.com. I&rsquo;ve been using our own internal version of <a href="http://www.limited-red.com">www.limited-red.com</a> which records all our test fails for every build on our continuous integration server.</p>

<p>With the Cucumber features I decided to plot the number of times a feature file has been significantly changed vs the number of times the feature has failed in the build. The theory being that a change to a feature file(the plain text specification of behaviour) most often represents a chance in functionality.</p>

<p>So I wrote a simple script checking the number of commits to each feature file.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">features_folder</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'><span class="n">feature_files</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">[</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">features_folder</span><span class="si">}</span><span class="s2">/**/*.feature&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">feature_files</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">feature_file</span><span class="o">|</span>
</span><span class='line'>  <span class="n">change_logs</span> <span class="o">=</span> <span class="sb">`git log --oneline </span><span class="si">#{</span><span class="n">feature_file</span><span class="si">}</span><span class="sb"> 2&gt;/dev/null`</span>
</span><span class='line'>  <span class="n">change_count</span> <span class="o">=</span> <span class="n">change_logs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">feature_file</span><span class="si">}</span><span class="s2">,</span><span class="si">#{</span><span class="n">change_count</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Feature changes compared with feature failures</h2>

<p>Throwing that into a pretty graph, here is a snapshot of some of the features (I&rsquo;ve changed the name of the features to hide top secret Songkick business).</p>

<p><img src="/images/blog/2011/07/feature_change_vs_failure1.png" alt="" /></p>

<h3>Insights</h3>

<p>Based on this I identified two possible groups of features:</p>

<ul>
<li><p>Features failing more often than the code around them is changing</p></li>
<li><p>Features which are robust and are not breaking when the code around them is changing.</p></li>
</ul>


<p>Further investigation into the suspect features highlighted 3 causes:</p>

<ul>
<li><p>Brittle step definitions</p></li>
<li><p>Brittle features coupled to the UI</p></li>
<li><p>Tests with a high dependency on asynchronous behaviour</p></li>
</ul>


<h2>Holes in the data &ndash; step definitions</h2>

<p>We only recorded the change rate of features files in Git. Features could be broken without ever changing the feature file, for example if a common step definition is broken. Next steps are to identify all the step definitions used by a feature and examine how often the step definitions have changed.</p>

<p>First find the change count for all the step definitions.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">step_files</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">[</span><span class="s2">&quot;features/**/*_steps.rb&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">step_files</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">step_file</span><span class="o">|</span>
</span><span class='line'>  <span class="n">change_logs</span> <span class="o">=</span> <span class="sb">`git log --oneline </span><span class="si">#{</span><span class="n">step_file</span><span class="si">}</span><span class="sb"> 2&gt;/dev/null`</span>
</span><span class='line'>  <span class="n">change_count</span> <span class="o">=</span> <span class="n">change_logs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">step_file</span><span class="si">}</span><span class="s2">,</span><span class="si">#{</span><span class="n">change_count</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then working out what step definitions a feature uses.  We can do this by running cucumber with the json formatter and match up step definitions (and hence step definition files) to feature files:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;json&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="sb">`cucumber features --dry-run --format json --out .json.out`</span>
</span><span class='line'><span class="n">features_json</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;.json.out&#39;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="n">stats</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span><span class="p">{</span><span class="o">|</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="o">|</span> <span class="n">h</span><span class="o">[</span><span class="n">k</span><span class="o">]</span> <span class="o">=</span> <span class="o">[]</span><span class="p">}</span>
</span><span class='line'><span class="n">features_json</span><span class="o">[</span><span class="s1">&#39;features&#39;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">feature</span><span class="o">|</span>
</span><span class='line'>  <span class="n">feature_name</span> <span class="o">=</span> <span class="n">feature</span><span class="o">[</span><span class="s1">&#39;name&#39;</span><span class="o">]</span>
</span><span class='line'>  <span class="c1">#The JSON does not have the feature file. Find the file via the feature name. Messy</span>
</span><span class='line'>  <span class="n">feature_file</span> <span class="o">=</span> <span class="sb">`egrep -riE &quot;feature:? *</span><span class="si">#{</span><span class="n">feature_name</span><span class="si">}</span><span class="sb">&quot; features/`</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>  <span class="n">feature</span><span class="o">[</span><span class="s2">&quot;elements&quot;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">element</span><span class="o">|</span>
</span><span class='line'>    <span class="n">element</span><span class="o">[</span><span class="s2">&quot;steps&quot;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">step</span><span class="o">|</span>
</span><span class='line'>      <span class="n">file_location</span> <span class="o">=</span> <span class="n">step</span><span class="o">[</span><span class="s1">&#39;match&#39;</span><span class="o">][</span><span class="s1">&#39;location&#39;</span><span class="o">]</span>
</span><span class='line'>      <span class="n">file</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">file_location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">file</span> <span class="o">=~</span> <span class="sr">/_steps\.rb$/</span>
</span><span class='line'>        <span class="n">stats</span><span class="o">[</span><span class="n">feature_file</span><span class="o">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">stats</span><span class="o">[</span><span class="n">feature_file</span><span class="o">]</span> <span class="o">+</span> <span class="o">[</span><span class="n">file</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">uniq</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">pp</span> <span class="n">stats</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Change rate vs Failure rate with step definition changes</h2>

<p>Combining those two bits of data we can now add to our original graph the step definition change rates for a feature.
<img src="/images/blog/2011/07/with_steps.png" alt="" /></p>

<p>We also can examine an individual break down of the step definition change rates for a feature:</p>

<p><img src="/images/blog/2011/07/step_def.png" alt="" /></p>

<h2>Holes in using the step definition change rate</h2>

<p>The step definition changes from git are at the file level (the *_step.rb file) so a change in git may not touch a step definition used by a feature. Hence we may be counting changes which are not relevant for a feature. Further work would be to examine the git diffs and check if a change touched a step definition used by a feature.</p>

<h2>Conclusions</h2>

<p>Our tests hide lots of interesting information that can provide evidence of areas we can make improvements. It&rsquo;s important to realise that like anything in statistics our data mining does not yield facts, just suggestions. At Songkick we are already mining this information with Cucumber and using it to help improve and learn about our tests.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/personal/conferences-and-accessibility-please-try-harder.html">Conferences and Accessibility: Please Try Harder</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-27T13:25:23+01:00" pubdate data-updated="true">Jun 27<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I speak at a lot of conferences around the world and I&rsquo;ve been happy to hear a lot of healthy debate around the diversity of the programming community. I really enjoyed and felt inspired by the talk from <a href="http://blogs.thewehners.net/josh">Joshua Wehner</a> on &ldquo;Must It Always Be About Sex&rdquo; at <a href="http://nordicruby.org/">Nordic Ruby</a> and <a href="http://rulu.eu/">Ruby Lugdunum.</a></p>

<p>It got me thinking about the issue of accessibility at conferences. I use a wheelchair and happily throw myself at any conference irrelevant of the obstacles. But not everyone is as crazy or as flexible as I am. Once at the conference the organisers are always willing to help but I wonder if we are not excluding disabled people who may dimiss the chance to talk or attend as unfeasible due to lack of information about access. Even if thats only a few people, those people are valuable members of our communities and deserve the chance to participate if they want to.</p>

<p>How would we ever know if we were discriminating, if no-one turns up in a wheelchair we are none the wiser.</p>

<p>I understand conferences are expensive and complicated events to organise. I would ask two small things of every conference organiser:</p>

<p><strong>1. Try and select an accessible venue if possible. For both speakers and attendees.</strong></p>

<p><strong>2. Make it clear on the conference website if the venue, party, hack sessions are accessible or not.</strong></p>

<p>My life was profoundly changed through speaking and attending conferences, in many ways beyond programming. I hope we can make sure anyone who wants that opportunity won&rsquo;t be put off.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/startups/startups-infiltrating-agile-and-xp.html">Startups Infiltrating Agile and XP</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-27T16:34:00+01:00" pubdate data-updated="true">May 27<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/blog/2011/05/Agile2011-badge.jpg" alt="" /> I&rsquo;m very excited to be talking at this years <a href="http://agile2011.agilealliance.org/">Agile2011</a> conference. Its a goal I&rsquo;ve been working towards for a long time.</p>

<p>I&rsquo;ve been to lots of agile conferences where I have listen to consultants talk about how they have made their multi-nationals or large organisations better through x. Interesting but often not much I could take away and apply at a startup.</p>

<p>Sadly there are only 4 talks at Agile2011 tagged with <em>Startups</em> and 6 tagged with <em>Lean Startup</em>.</p>

<p>I&rsquo;m passionate about startups and I want there to be more focus at agile events around them. Having spoken to lots of startups all over the world and living in the London startup hub, I all to often hear people dismiss Agile and XP events as not relevant. While there is a lot of activity around the <a href="http://en.wikipedia.org/wiki/Lean_Startup">Lean Startup</a> little is said about <a href="http://www.extremeprogramming.org/">Extreme Programming</a> and startups. The rich experience of the Agile community tends to  get lost. The Lean Startup has provided a movement which has helped deliver ideas from agile to startups, something agile conferences have failed at.</p>

<p>I&rsquo;m happy to be injecting a dose of startup with my talk at Agile2011 about <a href="http://submit2011.agilealliance.org/node/10782">Acceptance testing in the world of the startup</a>. I&rsquo;ll be drawing from my experiences of working at the startup <a href="http://www.songkick.com">Songkick.com</a>. Looking at the things we did badly, things we did well and things we still have no clue about.</p>

<p>I&rsquo;m also helping organise events in London and other major cities around Extreme Programming and Startups.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/training/the-art-of-cucumber-london-workshop.html">The Art of Cucumber London Workshop</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-26T11:21:13+01:00" pubdate data-updated="true">Apr 26<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="/images/blog/2011/04/1588795129-3.png"><img src="/images/blog/2011/04/1588795129-3.png" alt="" /></a>I&rsquo;ll be hosting a &frac12; workshop &ldquo;The Art of Cucumber&rdquo; at Skillsmatters in London. If you are interested in learning more about Cucumber, understanding how Cucumber can fit in software development and patterns for writing healthy Cukes this workshop is for you.</p>

<p>The workshop will also give you a sneak peek into my talk at Agile2011 (Salt Lake City)  and Spa2011 (London) without the big conference ticket price.</p>

<p>Book a place: <a href="http://theartofcucumber.eventbrite.com/">http://theartofcucumber.eventbrite.com/</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/testing/testing-outside-of-the-ruby-world.html">Testing Outside of the Ruby World</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-11T13:48:29+01:00" pubdate data-updated="true">Apr 11<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently spoke at the Scotland Ruby Conference about interesting testing tools and ideas outside of the Ruby community. The goal was to inspire the Ruby community to push the state of the art in testing.</p>

<h2>Slides</h2>

<script async class="speakerdeck-embed" data-id="4e7b46a413614c003f000dc9" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>


<h2>Further Resources</h2>

<ul>
<li><p><a href="http://www.haskell.org/haskellwiki/Introduction_to_QuickCheck">QuickCheck</a> &ndash; Haskell</p></li>
<li><p><a href="https://babel.ls.fi.upm.es/trac/McErlang/">McErlang</a> &ndash; Erlang</p></li>
<li><p><a href="https://github.com/marick/Midje/wiki">Midje</a> &ndash; Clojure</p></li>
<li><p><a href="http://ioke.org/">Ioke</a></p></li>
<li><p><a href="http://zombie.labnotes.org/">Zombie.js</a> &ndash; Javascript</p></li>
<li><p><a href="http://vowsjs.org/">Vows</a> &ndash; Javascript</p></li>
<li><p><a href="http://swarm.jquery.org/">TestSwarm</a> &ndash; Javascript</p></li>
<li><p><a href="http://www.threeriversinstitute.org/junitmax/subscribe.html">JUnitMax</a> &ndash; Java</p></li>
<li><p><a href="http://www.industriallogic.com/">Industrial Logic</a> &ndash; Java</p></li>
<li><p><a href="http://video.google.com/videoplay?docid=8755259214603465036#">Swim Lanes</a> &ndash; Ward Cunningham</p></li>
<li><p><a href="http://www.exampler.com/blog/2007/06/14/graphical-tests-again/">Graphical Tests</a> &ndash; Brian Marick</p></li>
<li><p><a href="http://www.quality-testing.com/wp-content/uploads/2009/06/testheuristicscheatsheetv1.pdf">Test Heuristics Cheat Sheet</a> &ndash; Elisabeth Hendrickson</p></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/agile/story-smells-the-valueless-story.html">Story Smells: The Valueless Story</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-10T15:00:17+00:00" pubdate data-updated="true">Mar 10<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>&ldquo;Why bother discussing the value or writing it down for the stories, everybody already knows what it is&rdquo;</p></blockquote>

<h2>Problem</h2>

<p>The value of a story to a stakeholder is not discussed or written on a card. The group participating in story writing workshop feel there is no point in dealing with the value since it seems obvious.</p>

<p>To a degree this is true, we should (hopefully) already know the high level business values that we want to achieve before we try and write any story cards. Otherwise we may end up with a <a href="http://blog.nayima.be/2009/12/30/how-do-you-estimate-the-business-value-of-user-stories/">vomit of user stories</a></p>

<p>Avoiding discussing or writing down the value on story cards can result in cards like this:</p>

<p><img src="/images/blog/2011/02/IMG_0473.jpg" alt="" /></p>

<h3>Whose value is it anyway?</h3>

<p>While we may already know our business values when writing stories I tend to shift the discussion to the users value. We know what we want, now why is a user going to do what we want? Note that this shift does not always apply, sometimes we want to force a user to do something that they don&rsquo;t want to do (such as filling in a captcha).</p>

<h2>Problems</h2>

<h3>Not discussing the value</h3>

<ul>
<li><p>Miss uncovering differences in underlying assumptions about why this feature is wanted.</p>

<ul>
<li>I&rsquo;ve witnessed too many groups who when jogged to think about the value start asking the right questions and discovering underlying differences in otherwise implicit assumptions.</li>
</ul>
</li>
<li><p>Create features you don&rsquo;t need </p>

<ul>
<li><a href="http://www.theregister.co.uk/2007/06/25/thoughtworks_req_manage/">popping the value stack</a> helps identify if you really need to build a feature.</li>
</ul>
</li>
</ul>


<h3>Not writing the value on a story card</h3>

<ul>
<li><p>Difficultly Prioritizing cards</p>

<ul>
<li>Knowing the value to a role of a feature can help guide a cards prioritisation.</li>
</ul>
</li>
<li><p>Physical cards on a board without any value, mean its not clear quickly why you are building this feature.</p>

<ul>
<li>When a card is being worked on by various roles knowing the value helps guide you to re-assess and ask relevant questions through the cards journey to being delivered.</li>
</ul>
</li>
</ul>


<h3>Using high level obvious values</h3>

<p>This problem can also be a symptom of expressing the value at too high a level. We all know we need to:</p>

<ul>
<li>Protect revenue</li>
<li>Increase revenue</li>
<li>Manage cost</li>
<li>Increase brand value</li>
<li>Make the product remarkable</li>
<li>Provide more value to your customers</li>
</ul>


<p>So putting it as a value for a narrative feels contrived and pointless.</p>

<h2>Solutions</h2>

<h3>Ask &lsquo;why?&rsquo;</h3>

<p>If a group feels the value is obvious they will have no trouble popping the why stack. Popping the why stack quickly uncovers questions and can lead to a refinement of what seemed obvious. At worst everyone in the group  has a shared understanding alining what they all saw as obvious.</p>

<h3>Feature Injection</h3>

<p>Try and structure narratives using the <a href="http://lizkeogh.com/2010/02/02/theyre-not-user-stories/">Feature injection format</a>:
<img src="/images/blog/2011/02/IMG_0475.jpg" alt="" /></p>

<p>Starting with the value as the very first thing you write can help ensure you don&rsquo;t progress onto the other points until you have at least discussed it.</p>

<h3>Avoid obvious values</h3>

<p>Make sure when you&rsquo;re discussing the value you drop down from the highest value to something that seems sensible to everyone.</p>

<h2>But what if the value really is obvious.</h2>

<p>Ok, sometimes a value does seem obvious, perhaps it&rsquo;s the same as a previous card. It is still important to write it down for the story and at least ask the question &lsquo;is this value obvious to everyone?&rsquo; and &lsquo;is this value meaningful to everyone?&rsquo;. Sometimes that is discussion enough.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/cucumber/page-object-pattern.html">Page Object Pattern</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-09T12:00:23+00:00" pubdate data-updated="true">Mar 9<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>What Is the Page Object Pattern?</h2>

<p>The Page model is a pattern that maps a UI page to a class, where for example a page could be a HTML page. The functionality to interact or make assertions about that that page is captured within the Page class. Then these methods may be called by a test. So ultimately we are introducing a gatekeeper to the GUI of a page.</p>

<p><img src="/images/blog/2010/12/page-model1.png" alt="" /></p>

<h2>Why use the Page Object Pattern?</h2>

<ul>
<li><p>Readable dsl for tests</p></li>
<li><p>Promotes Reuse</p></li>
<li><p>Centralise UI coupling &ndash; One place to make changes around the UI.</p></li>
</ul>


<h2>Implementing the Page Pattern in Cucumber</h2>

<p>Within Cucumber there are two main ways we can encapsulate the page UI:</p>

<h3>The Page Object Pattern</h3>

<p><em>features/pages/login_page.rb</em></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">LoginPage</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</span><span class='line'>    <span class="n">fill_in</span> <span class="ss">:user</span><span class="p">,</span> <span class="n">user</span>
</span><span class='line'>    <span class="n">fill_in</span> <span class="ss">:password</span> <span class="n">password</span>
</span><span class='line'>    <span class="n">click</span> <span class="s1">&#39;login&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">visit</span>
</span><span class='line'>    <span class="n">visit</span> <span class="s2">&quot;/login&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>features/step_definitions/user_steps.rb</em></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span> <span class="sr">/^I login with username &quot;Joseph&quot; and password &quot;cuker&quot;$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">|</span>
</span><span class='line'>  <span class="n">login_page</span> <span class="o">=</span> <span class="no">LoginPage</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">login_page</span><span class="o">.</span><span class="n">visit</span>
</span><span class='line'>  <span class="n">login_page</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>The Page Step definition Pattern</h3>

<p>Cucumber step definitions are all defined at the same scope, but we use folders and files to create logical organisation. We can create folders for UI step definitions and domain step definitions.</p>

<ul>
<li><p>features/domain/step_definitions/*</p></li>
<li><p>features/ui/step_definitions/*</p></li>
</ul>


<p>We create a step definition file mapping to a UI page.
<em>features/ui/step_definitions/login_page_steps.rb</em></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span> <span class="sr">/^I login with username &quot;Joseph&quot; and password &quot;cuker&quot;$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">|</span>
</span><span class='line'>  <span class="n">fill_in</span> <span class="ss">:user</span><span class="p">,</span> <span class="n">user</span>
</span><span class='line'>  <span class="n">fill_in</span> <span class="ss">:password</span> <span class="n">password</span>
</span><span class='line'>  <span class="n">click</span> <span class="s1">&#39;login&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Whats the right way to encapsulate the UI?</h2>

<p>Just using step definitions for organisation within a project can have a number of problems:</p>

<p><strong>Global scope within Cucumbers world</strong>
Instance variables are global across all step definitions</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span> <span class="sr">/^I mess with scope$/</span> <span class="k">do</span>
</span><span class='line'>  <span class="vi">@this_can_be_seen_by_every_other_step</span> <span class="o">=</span> <span class="s1">&#39;uh oh&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Managed and run through Cucumber</strong>
No easy way to be reused outside of Cucumber or test in isolation. By isolating the test code we can easily provide adapters for reuse in different test frameworks (for example similar to what <a href="https://github.com/bmabey/email-spec">email-spec</a> does).</p>

<p>The Page Object pattern (and adding another layer of abstraction) has a couple of nice properties:</p>

<ul>
<li><p>Bounded scope (if you use your classes/objects nicely)</p></li>
<li><p>Isolated units that can be invoked and controlled independently of overarching testing framework</p></li>
</ul>


<h2>Should I be using the Page Object Pattern?</h2>

<p>Yes, No, Maybe.</p>

<p>Extra layers of abstraction introduce complexity and so the Page Object Pattern should be used carefully when there is a sufficiently high burden of maintenance (which usually means lots of step definitions).</p>

<p>Its important outside of the Page object pattern to realise the weaknesses of just using step definitions as your only modelling tool. Irrelevant of what metaphor you decide to organise around it&rsquo;s a good habit to push the code out of the step definitions.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
  <li class="post">
    <a href="/art/emacs-as-a-musical-instrument.html">Emacs as a musical instrument</a>
  </li>

    
      <li class="post">
        <a href="/clojure/functions-explained-through-patterns.html">Functions Explained Through Patterns</a>
      </li>
    
      <li class="post">
        <a href="/art/audio-fingerprint-smudges.html">Audio Fingerprint Smudges</a>
      </li>
    
      <li class="post">
        <a href="/art/overtone-shader-visuals.html">Visuals with Overtone and Shadertone</a>
      </li>
    
      <li class="post">
        <a href="/art/emacs-animation.html">Animations with Emacs</a>
      </li>
    
      <li class="post">
        <a href="/clojure/clojure-and-kinesis-at-scale.html">Clojure and Kinesis at scale</a>
      </li>
    
      <li class="post">
        <a href="/clojure/overtone-driving-minecraft.html">Clojure and Overtone driving Minecraft</a>
      </li>
    
      <li class="post">
        <a href="/art/live-coding-repl-electric.html">Live Coding - Repl Electric</a>
      </li>
    
      <li class="post">
        <a href="/clojure/creative_machines.html">Creative Machines</a>
      </li>
    
      <li class="post">
        <a href="/clojure/sounds-of-the-human-brain.html">Sounds of the human brain</a>
      </li>
    
      <li class="post">
        <a href="/clojure/building-clojure-services-at-scale.html">Building Clojure services at scale</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/josephwilk">@josephwilk</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'josephwilk',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Joseph Wilk -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'josephwilk';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
