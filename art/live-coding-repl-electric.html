
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Live Coding - Repl Electric - Joseph Wilk</title>
  <meta name="author" content="Joseph Wilk">

  
  <meta name="description" content="Live coding is the act of turning a programming session into a performance. This can constitute improvisation, music, visuals, poetry, hardware, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://josephwilk.github.io/art/live-coding-repl-electric.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Joseph Wilk" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<script src="http://disqus.com/forums/josephwilk/embed.js"></script>
<link href="http://fonts.googleapis.com/css?family=Bevan" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3020740-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <img src="/images/joe_small.jpg" style="position:relative;border-radius: 8px;margin-right: 5px;border-style: solid;border-width: 1px;border-color: #DDD;" height="60" alt="Joseph Wilk">
  <span style="display:inline-block">
    <h1><a href="/">Joseph Wilk</a></h1>
    <h2>Programming bits and bobs</h2>
  </span>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:josephwilk.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
 <li><a href="/">Home</a></li>
 <li><a href="/about">About</a></li>
 <li><a href="/speaking">Speaking</a></li>
 <li><a href="/contact">Contact</a></li>
 <li><a href="/archives">Archives</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Live Coding - Repl Electric</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-13T15:58:12+01:00" pubdate data-updated="true">Jun 13<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Live coding is the act of turning a programming session into a performance. This can constitute improvisation, music, visuals, poetry, hardware, robots, dance, textiles and people. Pretty much anything with an input and output can be controlled live by programming.</p>

<p>This is not just a performance by programmers for programmers. While this is often where it starts as a live coder, the type of audience and the accessibility of the performance lies in the performers imagination. Abstraction can get us pretty much anywhere.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">the-stars</span> <span class="p">(</span><span class="nf">dark-matter</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Repl Electric</h2>

<p><img src="https://camo.githubusercontent.com/d1711cc92a1b79af187344f461be35e2ced44e3f/687474703a2f2f7333302e706f7374696d672e6f72672f7633336377783668642f53637265656e5f53686f745f323031345f30345f32385f61745f32305f31345f33352e706e67"/></p>

<p><a href="http://www.repl-electric.com">Repl Electric</a> is a project I started in order to discover more about music composition and Artificial intelligent based aids to creativity. Which in turn through the inspiration of people like <a href="http://meta-ex.com/">Meta-ex</a> lead me to live programming music.</p>

<p>Here is a performance live coding music and graphics, inspired by a performance in London:</p>

<h3>The Stars</h3>

<iframe src="//player.vimeo.com/video/95988263" width="500" height="313" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>


<h3>Open Live Coding</h3>

<p>All the tools and code used to create this performance are open for all to see on Github: <a href="https://github.com/repl-electric">https://github.com/repl-electric</a></p>

<p>Three programming languages were used to create this piece:</p>

<ul>
<li>Clojure (Sound)</li>
<li>GLSL (Visuals)</li>
<li>Emacs Lisp (Animations &amp; Navigation)</li>
</ul>


<h3>Tools</h3>

<p>Here are the tools used and a little detail around how they where used in performing &ldquo;The Stars&rdquo;:</p>

<h4>Clojure: <a href="http://clojure.org">http://clojure.org</a></h4>

<p>Clojure is a LISP language based on the JVM.</p>

<p>Clojure focuses on interactive REPL (Read, Evaluate, Print &amp; Loop) driven development. Which makes it a good choice for interactively coding music. It also turns out functional programming is a good fit for operating over music as data.</p>

<h4>Emacs Live: <a href="https://github.com/overtone/emacs-live">https://github.com/overtone/emacs-live</a></h4>

<p>Emacs live is a Emacs release with packages and defaults that are Live Coding centric. Something I use for both for my work and for my live coding.</p>

<p>To execute our code, we launch a repl instance in our project (NEVER launch inside emacs, since then if emacs crashes the repl and music dies) and connect to it from emacs using <code>cider</code> <a href="https://github.com/clojure-emacs/cider.">https://github.com/clojure-emacs/cider.</a></p>

<p>A simple trick to combine Emacs code and visualizations is to launch an OpenGL window in full screen (see Shadertone) and then put a full screen transparent terminal window running emacs over it.</p>

<p><img src="/images/terminal.png" alt="" /></p>

<p>The tumbling text effect seen at the end of the performance is an emacs animation using <code>Zone Mode</code> which supports writing your own text destructors: <a href="http://www.emacswiki.org/emacs/ZoneMode">http://www.emacswiki.org/emacs/ZoneMode</a></p>

<h4>Overtone: <a href="https://github.com/overtone/overtone">https://github.com/overtone/overtone</a></h4>

<p>Overtone is a Clojure based client to <a href="http://supercollider.sourceforge.net">SuperCollider</a>. Supercollider is an environment for real time audio synthesis and algorithmic composition.</p>

<p>Overtone provides us with:</p>

<ul>
<li>Timing (beat generation &ndash; <a href="https://github.com/repl-electric/cassiopeia/blob/master/src/cassiopeia/engine/timing.clj">example timing code</a>).</li>
<li>Building Synths (engineer sound).</li>
<li>Running samples (both your own and from <a href="https://www.freesound.org/">Freesound</a>).</li>
<li>Live Synth control (changing notes, durations, reverb, etc).</li>
<li>Hardware interaction (through midi or OSC).</li>
</ul>


<p>An example of a synth used in The Stars:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">use</span> <span class="ss">&#39;overtone.live</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nf">defsynth</span> <span class="nv">dark-ambience</span> <span class="p">[</span><span class="nv">out-bus</span> <span class="mi">0</span> <span class="nv">amp</span> <span class="mi">1</span> <span class="nv">mul</span> <span class="mf">0.2</span> <span class="nv">room-size</span> <span class="mi">70</span> <span class="nv">rev-time</span> <span class="mi">99</span> <span class="nv">freq</span> <span class="mi">60</span> <span class="nv">ring-mul</span> <span class="mi">55</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">pink</span> <span class="p">(</span><span class="nf">hpf</span><span class="ss">:ar</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nb">* </span><span class="mf">0.005</span> <span class="p">(</span><span class="nf">pink-noise</span><span class="p">))</span> <span class="p">(</span><span class="nf">line</span><span class="ss">:kr</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">9</span><span class="p">))</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">src1</span> <span class="p">(</span><span class="nf">ringz</span> <span class="p">(</span><span class="nb">* </span><span class="nv">pink</span> <span class="p">(</span><span class="nf">lf-noise1</span><span class="ss">:kr</span> <span class="mf">0.15</span><span class="p">))</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">freq</span> <span class="p">(</span><span class="nb">* </span><span class="nv">ring-mul</span> <span class="mi">0</span><span class="p">))</span> <span class="nv">mul</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">src2</span> <span class="p">(</span><span class="nf">ringz</span> <span class="p">(</span><span class="nb">* </span><span class="nv">pink</span> <span class="p">(</span><span class="nf">lf-noise1</span><span class="ss">:kr</span> <span class="mf">0.15</span><span class="p">))</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">freq</span> <span class="p">(</span><span class="nb">* </span><span class="nv">ring-mul</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">mul</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">src3</span> <span class="p">(</span><span class="nf">ringz</span> <span class="p">(</span><span class="nb">* </span><span class="nv">pink</span> <span class="p">(</span><span class="nf">lf-noise1</span><span class="ss">:kr</span> <span class="mf">0.15</span><span class="p">))</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">freq</span> <span class="p">(</span><span class="nb">* </span><span class="nv">ring-mul</span> <span class="mi">2</span><span class="p">))</span> <span class="nv">mul</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">src</span> <span class="p">(</span><span class="nf">tanh</span> <span class="p">(</span><span class="nf">g-verb</span> <span class="p">(</span><span class="nf">sum</span> <span class="p">[</span><span class="nv">src1</span> <span class="nv">src2</span> <span class="nv">src3</span><span class="p">])</span> <span class="nv">room-size</span> <span class="nv">rev-time</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">out</span> <span class="nv">out-bus</span> <span class="p">(</span><span class="nb">* </span><span class="nv">amp</span> <span class="nv">src</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">the-stars</span> <span class="p">(</span><span class="nf">dark-ambience</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h6>Timing</h6>

<p>Timing is a complicated issue but so important its worth touching on. You have a choice with Overtone to use Java for timing or Supercollider. I use Supercollider since I have found it to be much more reliable.
Everything you need is here (<a href="https://github.com/repl-electric/cassiopeia/blob/master/src/cassiopeia/engine/timing.clj">copy and paste</a>), thanks to the hard work of <a href="https://github.com/samaaron">Sam Aaron</a>.</p>

<p>The key concept to take away is there are two types of timing, a beat counter which is forever incrementing and a beat trigger which flips back and forth between 1/0.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">cassiopeia.engine.timing</span> <span class="ss">:as</span> <span class="nv">time</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;;The beat trigger</span>
</span><span class='line'><span class="p">(</span><span class="ss">:beat</span> <span class="nv">time/main-beat</span><span class="p">)</span> <span class="c1">;=&gt; 0,1,0,1,0,1,0</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;;The beat counter</span>
</span><span class='line'><span class="p">(</span><span class="ss">:count</span> <span class="nv">time/main-beat</span><span class="p">)</span> <span class="c1">;=&gt; 0,1,2,3,4,5,6,7,8,9</span>
</span></code></pre></td></tr></table></div></figure>


<p>The counter is useful for indexing buffers, the trigger is useful in controlling the gate of an envelope (which turns a sound on or off).</p>

<p>In Clojure we can still get access to the beat, in our timing code we send a message using <code>send-trig</code> on every beat. We can hook a Clojure function to callback on this beat:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">on-trigger</span> <span class="p">(</span><span class="ss">:trig-id</span> <span class="nv">time/main-beat</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">beat-no</span><span class="p">]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">= </span><span class="mf">0.0</span> <span class="p">(</span><span class="nf">mod</span> <span class="nv">beat-no</span> <span class="mi">32</span><span class="p">))</span>
</span><span class='line'>      <span class="c1">;;play a sample</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">boom-s</span><span class="p">)))</span>
</span><span class='line'>  <span class="ss">::on-beat-trigger</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>I use this extensively to time graphic transitions with the music.</p>

<h6>Buffers</h6>

<p>Most of my live coding performance was writing to buffers which are hooked into synths. Buffers are just fixed size arrays but they are stored in Supercollider rather than in Clojure. Here is an example from The Stars where the midi notes are read from a buffer at a rate based on my beat timing signal (a 16th of the main beat here).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">use</span> <span class="ss">&#39;overtone.live</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nf">use</span> <span class="ss">&#39;cassiopeia.engine.core</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">cassiopeia.engine.timing</span> <span class="ss">:as</span> <span class="nv">time</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">defsynth</span> <span class="nv">growl</span> <span class="p">[</span><span class="nv">out-bus</span> <span class="mi">0</span> <span class="nv">note-buf</span> <span class="mi">0</span> <span class="nv">beat-bus</span> <span class="mi">0</span> <span class="nv">beat-trg-bus</span> <span class="mi">0</span> <span class="nv">amp</span> <span class="mi">1</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">cnt</span> <span class="p">(</span><span class="nf">in</span><span class="ss">:kr</span> <span class="nv">beat-bus</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">trg</span> <span class="p">(</span><span class="nf">in</span><span class="ss">:kr</span> <span class="nv">beat-trg-bus</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">note</span> <span class="p">(</span><span class="nf">buf-rd</span><span class="ss">:kr</span> <span class="mi">1</span> <span class="nv">note-buf</span> <span class="nv">cnt</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">freq</span> <span class="p">(</span><span class="nf">midicps</span> <span class="nv">note</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">vol</span> <span class="p">(</span><span class="nb">&gt; </span><span class="nv">note</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">e</span> <span class="p">(</span><span class="nf">env-gen</span> <span class="p">(</span><span class="nf">perc</span> <span class="ss">:attack</span> <span class="mi">10</span> <span class="ss">:sustain</span> <span class="mi">1</span> <span class="ss">:release</span> <span class="mi">1</span><span class="p">)</span> <span class="ss">:gate</span> <span class="nv">trg</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">src</span> <span class="p">(</span><span class="nf">lpf</span> <span class="p">(</span><span class="nf">mix</span> <span class="p">[(</span><span class="nf">saw</span> <span class="p">(</span><span class="nb">* </span><span class="mf">0.25</span> <span class="nv">freq</span><span class="p">))</span>
</span><span class='line'>                       <span class="p">(</span><span class="nf">sin-osc</span> <span class="p">(</span><span class="nb">* </span><span class="mf">1.01</span> <span class="nv">freq</span><span class="p">))]))</span>
</span><span class='line'>        <span class="nv">src</span> <span class="p">(</span><span class="nf">pitch-shift</span> <span class="nv">src</span> <span class="mf">0.4</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mf">0.01</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">src</span> <span class="p">(</span><span class="nf">pan2</span><span class="ss">:ar</span> <span class="p">(</span><span class="nb">* </span><span class="nv">vol</span> <span class="nv">amp</span> <span class="nv">e</span> <span class="nv">src</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">out</span> <span class="nv">out-bus</span> <span class="nv">src</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defonce </span><span class="nv">nebular</span> <span class="p">(</span><span class="nf">buffer</span> <span class="mi">96</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">nebula</span> <span class="p">(</span><span class="nf">growl</span> <span class="ss">:note-buf</span> <span class="nv">nebula-note-buf</span> <span class="ss">:beat-trg-bus</span> <span class="p">(</span><span class="ss">:beat</span> <span class="nv">time/beat-16th</span><span class="p">)</span> <span class="ss">:beat-bus</span> <span class="p">(</span><span class="ss">:count</span> <span class="nv">time/beat-16th</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">pattern!</span> <span class="nv">nebula-note-buf</span> <span class="p">(</span><span class="nf">degrees</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">7</span><span class="p">]</span> <span class="ss">:major</span> <span class="ss">:A2</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h4>GLSL + Shadertone:  <a href="https://github.com/overtone/shadertone">https://github.com/overtone/shadertone</a></h4>

<p>Shaders generate imagery directly on your Graphics Processing Unit rather than going through your CPU. Through a language called GLSL (which is C like) we can express very simple functions which get called on every single pixel generating complex visuals. Here is a simple extract from The Stars that generates all the background small dots:</p>

<p><img src="/images/glsl-dots.png" alt="" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='glsl'><span class='line'><span class="k">void</span> <span class="n">main</span><span class="p">(</span><span class="k">void</span><span class="p">){</span>
</span><span class='line'>  <span class="k">vec2</span> <span class="n">current_pixel_position</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">gl_FragCoord</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span> <span class="o">-</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>  <span class="k">float</span> <span class="n">distance_squared</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">current_pixel_position</span><span class="p">,</span> <span class="n">current_pixel_position</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">vec4</span> <span class="n">black</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="mf">.0</span><span class="p">,</span> <span class="mf">.0</span><span class="p">,</span> <span class="mf">.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span><span class='line'>  <span class="k">vec4</span> <span class="n">white</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//Test the current pixel position and if it should be a circle shade it.</span>
</span><span class='line'>  <span class="k">vec4</span> <span class="n">circles</span> <span class="o">=</span> <span class="p">(</span><span class="n">distance_squared</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">)</span> <span class="o">?</span> <span class="n">white</span> <span class="o">:</span> <span class="n">black</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">gl_FragColor</span> <span class="o">=</span> <span class="n">circles</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For more examples of whats possible with Shaders checkout <a href="https://www.shadertoy.com">Shader Toy</a></p>

<p>Shadertone is the Clojure library that provides a convenient way of running shaders from Clojure and for feeding in data about our synths. It provides access in your Shader to:</p>

<ul>
<li>Overtone&rsquo;s Volume (<code>iOvertoneVolume</code>)</li>
<li>The frequency spectrum &amp; audio waveform data (Passed as a 2D texture <code>:textures [:overtone-audio]</code>)</li>
</ul>


<p>To synchronize the graphics with the music I created a special Overtone synth which does not generate any sound, it instead feeds information in realtime to my shader.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">use</span> <span class="ss">&#39;overtone.live</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">shadertone.core</span> <span class="ss">:as</span> <span class="nv">t</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;;A synth that exposes through taps all the lovely timing information.</span>
</span><span class='line'><span class="p">(</span><span class="nf">defsynth</span> <span class="nv">buffer-&gt;tap</span> <span class="p">[</span><span class="nv">beat-buf</span> <span class="mi">0</span> <span class="nv">beat-bus</span> <span class="mi">0</span> <span class="nv">beat-size</span> <span class="mi">16</span> <span class="nv">measure</span> <span class="mi">6</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">cnt</span> <span class="p">(</span><span class="nf">in</span><span class="ss">:kr</span> <span class="nv">beat-bus</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">beat</span> <span class="p">(</span><span class="nf">buf-rd</span><span class="ss">:kr</span> <span class="mi">1</span> <span class="nv">beat-buf</span> <span class="nv">cnt</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">_</span>  <span class="p">(</span><span class="nf">tap</span> <span class="s">&quot;beat&quot;</span>          <span class="mi">60</span> <span class="p">(</span><span class="nf">a2k</span> <span class="nv">beat</span><span class="p">))</span>
</span><span class='line'>        <span class="nv">_</span>  <span class="p">(</span><span class="nf">tap</span> <span class="s">&quot;beat-count&quot;</span>    <span class="mi">60</span> <span class="p">(</span><span class="nf">a2k</span> <span class="p">(</span><span class="nf">mod</span> <span class="nv">cnt</span> <span class="nv">beat-size</span><span class="p">)))</span>
</span><span class='line'>        <span class="nv">_</span>  <span class="p">(</span><span class="nf">tap</span> <span class="s">&quot;measure-count&quot;</span> <span class="mi">60</span> <span class="p">(</span><span class="nf">a2k</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">mod</span> <span class="nv">cnt</span> <span class="p">(</span><span class="nb">* </span><span class="nv">measure</span> <span class="nv">beat-size</span><span class="p">))</span> <span class="nv">measure</span><span class="p">)))])</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">out</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;;; Used to store our drum beat, 1 for a hit 0 and for a miss</span>
</span><span class='line'><span class="p">(</span><span class="kd">defonce </span><span class="nv">drum-sequence-buffer</span> <span class="p">(</span><span class="nf">buffer</span> <span class="mi">256</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">beats</span> <span class="p">(</span><span class="nf">buffer-&gt;tap</span> <span class="nv">drum-sequence-buffer</span> <span class="p">(</span><span class="ss">:count</span> <span class="nv">timing/main-beat</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;;Open a OpenGL window running our shader</span>
</span><span class='line'><span class="p">(</span><span class="nf">t/start-fullscreen</span> <span class="s">&quot;resources/shaders/electric.glsl&quot;</span>
</span><span class='line'>                    <span class="ss">:user-data</span> <span class="p">{</span>
</span><span class='line'>                    <span class="s">&quot;iBeat&quot;</span>         <span class="p">(</span><span class="nf">atom</span> <span class="p">{</span><span class="ss">:synth</span> <span class="nv">beats</span> <span class="ss">:tap</span> <span class="s">&quot;beat&quot;</span><span class="p">})</span>
</span><span class='line'>                    <span class="s">&quot;iBeatCount&quot;</span>    <span class="p">(</span><span class="nf">atom</span> <span class="p">{</span><span class="ss">:synth</span> <span class="nv">beats</span> <span class="ss">:tap</span> <span class="s">&quot;beat-count&quot;</span><span class="p">})</span>
</span><span class='line'>                    <span class="s">&quot;iMeasureCount&quot;</span> <span class="p">(</span><span class="nf">atom</span> <span class="p">{</span><span class="ss">:synth</span> <span class="nv">beats</span> <span class="ss">:tap</span> <span class="s">&quot;measure-count&quot;</span><span class="p">})})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Inside our shader code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='glsl'><span class='line'><span class="k">uniform</span> <span class="k">float</span> <span class="n">iBeat</span><span class="p">;</span>
</span><span class='line'><span class="k">uniform</span> <span class="k">float</span> <span class="n">iBeatCount</span><span class="p">;</span>
</span><span class='line'><span class="k">uniform</span> <span class="k">float</span> <span class="n">iMeasureCount</span><span class="p">;</span>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>The other main way of controlling a shader from Clojure is using <code>atoms</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">shadertone.core</span> <span class="ss">:as</span> <span class="nv">t</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defonce </span><span class="nv">cellular-growth</span> <span class="p">(</span><span class="nf">atom</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">t/start-fullscreen</span> <span class="s">&quot;resources/shaders/electric.glsl&quot;</span> <span class="ss">:user-data</span> <span class="p">{</span><span class="s">&quot;iCellularGrowth&quot;</span> <span class="nv">cellular-growth</span><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">swap!</span> <span class="nv">cellular-growth</span> <span class="nb">+ </span><span class="mf">0.01</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Hardware: Monome: <a href="http://monome.org">http://monome.org</a></h4>

<p>Something you don&rsquo;t see in the video is that I&rsquo;m using a 8x16 <a href="http://monome.org">Monome</a>. For this performance its primary function was a visual aid to show the beat/measure information.</p>

<p><img src="/images/monome.jpg" alt="Monome" /></p>

<p>The hardware is driven by Clojure communicating with the Monome through a serial port: <a href="https://github.com/josephwilk/monome-serial/tree/protocols">https://github.com/josephwilk/monome-serial/tree/protocols</a></p>

<h1>Live Coding</h1>

<p>Live coding music and graphics combines skills in sound engineering, 3d graphics, geometry, physics, musical theory, composition, improvisation &amp; hardware to name a few.</p>

<p>It is difficult, and requires a lot of work and practice.</p>

<p>But of all the code I&rsquo;ve written over the years this is one of the things I&rsquo;m most proud of. And i&rsquo;m only at the beginning of discovering what&rsquo;s possible.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Joseph Wilk</span></span>

      








  


<time datetime="2014-06-13T15:58:12+01:00" pubdate data-updated="true">Jun 13<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/art'>art</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://josephwilk.github.io/art/live-coding-repl-electric.html" data-via="josephwilk" data-counturl="http://josephwilk.github.io/art/live-coding-repl-electric.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="small"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/clojure/creative_machines.html" title="Previous Post: Creative Machines">&laquo; Creative Machines</a>
      
      
        <a class="basic-alignment right" href="/clojure/overtone-driving-minecraft.html" title="Next Post: Clojure and Overtone driving Minecraft">Clojure and Overtone driving Minecraft &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/art/overtone-shader-visuals.html">Visuals with Overtone and Shadertone</a>
      </li>
    
      <li class="post">
        <a href="/art/emacs-animation.html">Animations with Emacs</a>
      </li>
    
      <li class="post">
        <a href="/clojure/clojure-and-kinesis-at-scale.html">Clojure and Kinesis at scale</a>
      </li>
    
      <li class="post">
        <a href="/clojure/overtone-driving-minecraft.html">Clojure and Overtone driving Minecraft</a>
      </li>
    
      <li class="post">
        <a href="/art/live-coding-repl-electric.html">Live Coding - Repl Electric</a>
      </li>
    
      <li class="post">
        <a href="/clojure/creative_machines.html">Creative Machines</a>
      </li>
    
      <li class="post">
        <a href="/clojure/sounds-of-the-human-brain.html">Sounds of the human brain</a>
      </li>
    
      <li class="post">
        <a href="/clojure/building-clojure-services-at-scale.html">Building Clojure services at scale</a>
      </li>
    
      <li class="post">
        <a href="/clojure/creating-instruments-with-overtone.html">Creating sampled instruments with Overtone</a>
      </li>
    
      <li class="post">
        <a href="/elixir/sets-in-elixir.html">Sets in Elixir</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/josephwilk">@josephwilk</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'josephwilk',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Joseph Wilk -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'josephwilk';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://josephwilk.github.io/art/live-coding-repl-electric.html';
        var disqus_url = 'http://josephwilk.github.io/art/live-coding-repl-electric.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
